name: Daily Data Backup

on:
  schedule:
    - cron: '0 2 * * *'  # Run at 2 AM UTC daily
  workflow_dispatch:  # Allow manual triggers

jobs:
  backup:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      
    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '16'
        
    - name: Create Backup Archive
      run: |
        echo "Creating backup archive..."
        BACKUP_DATE=$(date -u +"%Y-%m-%dT%H-%M-%SZ")
        BACKUP_FILE="backup_${BACKUP_DATE}.json"
        
        # Create sample backup data (in real use, this would be your actual data)
        echo '{
          "backup_date": "'"$BACKUP_DATE"'",
          "system": "OBATA SMART SAVINGS",
          "version": "2.3",
          "note": "Auto-generated backup"
        }' > "$BACKUP_FILE"
        
        # Create backups directory if it doesn't exist
        mkdir -p backups
        
        # Move backup to backups directory
        mv "$BACKUP_FILE" "backups/"
        
        # Create README
        echo "# OBATA SMART SAVINGS - Data Backups

This directory contains automated backups of the OBATA SMART SAVINGS system.

## Backup Schedule
- Daily at 2:00 AM UTC
- Manual triggers via GitHub Actions

## Files
- Each backup is a JSON file with timestamp
- Files are kept for 30 days automatically

## Restoring
To restore from backup:
1. Download the desired backup file
2. Use the 'Restore' feature in the application
3. Select the downloaded JSON file

## Notes
- Backups are automatically cleaned up after 30 days
- Total storage limited to 1GB
- Backups are versioned for easy recovery

Last updated: $BACKUP_DATE" > backups/README.md
        
        echo "Backup created: backups/$BACKUP_FILE"
        
    - name: Upload Backup
      uses: actions/upload-artifact@v3
      with:
        name: data-backup
        path: backups/
        retention-days: 30